title: 安卓获取图片的缩略图
tags:
  - bitmap
id: 232
categories:
  - Android
date: 2015-07-28 15:21:31
---

几个月前都接触过了这块，没来得及总结，现在终于有时间了。

## **获取图片缩略图**

以下代码摘自[CSDN博客](http://blog.csdn.net/akon_vm/article/details/7419274)：

<pre class="lang:java decode:true">/**
     * 根据指定的图像路径和大小来获取缩略图
     * 此方法有两点好处：
     *     1\. 使用较小的内存空间，第一次获取的bitmap实际上为null，只是为了读取宽度和高度，
     *        第二次读取的bitmap是根据比例压缩过的图像，第三次读取的bitmap是所要的缩略图。
     *     2\. 缩略图对于原图像来讲没有拉伸，这里使用了2.2版本的新工具ThumbnailUtils，使
     *        用这个工具生成的图像不会被拉伸。
     * @param imagePath 图像的路径
     * @param width 指定输出图像的宽度
     * @param height 指定输出图像的高度
     * @return 生成的缩略图
     */
    private Bitmap getImageThumbnail(String imagePath, int width, int height) {
        Bitmap bitmap = null;
        BitmapFactory.Options options = new BitmapFactory.Options();
        options.inJustDecodeBounds = true;
        // 获取这个图片的宽和高，注意此处的bitmap为null
        bitmap = BitmapFactory.decodeFile(imagePath, options);
        options.inJustDecodeBounds = false; // 设为 false
        // 计算缩放比
        int h = options.outHeight;
        int w = options.outWidth;
        int beWidth = w / width;
        int beHeight = h / height;
        int be = 1;
        if (beWidth &lt; beHeight) {
            be = beWidth;
        } else {
            be = beHeight;
        }
        if (be &lt;= 0) {
            be = 1;
        }
        options.inSampleSize = be;
        // 重新读入图片，读取缩放后的bitmap，注意这次要把options.inJustDecodeBounds 设为 false
        bitmap = BitmapFactory.decodeFile(imagePath, options);
        // 利用ThumbnailUtils来创建缩略图，这里要指定要缩放哪个Bitmap对象
        bitmap = ThumbnailUtils.extractThumbnail(bitmap, width, height,
                ThumbnailUtils.OPTIONS_RECYCLE_INPUT);
        return bitmap;
    }</pre>

代码中，主要注意设置

    options.inJustDecodeBounds = true;

表示只读取图片的宽高，不用读取图片的内容，加快了读取速度。这段代码的高明之处在于第三次的读取缩略图：

<pre class="lang:java decode:true">bitmap = ThumbnailUtils.extractThumbnail(bitmap, width, height,
                    ThumbnailUtils.OPTIONS_RECYCLE_INPUT);</pre>

前面的按照比例读取缩略图时，获取的比例**inSampleSize**为整数，decode出来的图片宽高并不是width和height。所以需要使用上述代码获取真正的宽高分别为width和height的图片。对于图片这样的内存占用大户，上述做法能有效减少内存占用量。