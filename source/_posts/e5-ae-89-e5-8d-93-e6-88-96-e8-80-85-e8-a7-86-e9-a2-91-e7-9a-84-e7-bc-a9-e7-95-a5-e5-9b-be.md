title: 安卓获取视频的缩略图
tags:
  - Image
  - Video
id: 248
categories:
  - Android
date: 2015-08-02 08:30:00
---

本文总结下安卓开发中获取视频缩略图的几种方法：

1.  通过内容提供器搜索系统数据库获取；
2.  通过系统提供的ThumbnailUtils获取；
3.  由MediaMetadataRetriever来获取；

### 方法一

首先上代码：

<pre class="lang:java decode:true ">/** 
* @param context 
* @param cr
* @param Videopath
* @return 
*/
public static Bitmap getVideoThumbnail(Context context, ContentResolver cr, String Videopath) { 
    ContentResolver testcr = context.getContentResolver(); 
    String[] projection = { MediaStore.Video.Media.DATA, MediaStore.Video.Media._ID, }; 
    String whereClause = MediaStore.Video.Media.DATA + " = '" + Videopath + "'"; 
    Cursor cursor = testcr.query(MediaStore.Video.Media.EXTERNAL_CONTENT_URI, projection, whereClause, 
        null, null); 
    int _id = 0; 
    String videoPath = ""; 
    if (cursor == null || cursor.getCount() == 0) { 
        return null; 
    } 
    if (cursor.moveToFirst()) { 

        int _idColumn = cursor.getColumnIndex(MediaStore.Video.Media._ID); 
        int _dataColumn = cursor.getColumnIndex(MediaStore.Video.Media.DATA); 
        do { 
            _id = cursor.getInt(_idColumn); 
            videoPath = cursor.getString(_dataColumn); 
        } while (cursor.moveToNext()); 
    } 
    cursor.close();
    BitmapFactory.Options options = new BitmapFactory.Options(); 
    options.inDither = false; 
    options.inPreferredConfig = Bitmap.Config.RGB_565; 
    Bitmap bitmap = MediaStore.Video.Thumbnails.getThumbnail(cr, _id, Images.Thumbnails.MINI_KIND, 
        options); 
    return bitmap; 
}</pre>

代码中，依然使用了**_BitmapFactory.Options_**来压缩图片，使用方式还可参见[这篇文章](http://yunuschan.com/?p=232)。上述的方法的**缺点**是，如果有新的视频加入，必须**更新系统数据库**才能获取新加入视频的缩略图。

### 方法二

这种方法用得较多，代码也简单：

<pre class="lang:java decode:true ">/**
 * 获取视频缩略图
 * @param videoPath
 * @param width
 * @param height
 * @param kind
 * @return
 */
private Bitmap getVideoThumbnail(String videoPath, int width , int height, int kind){
    Bitmap bitmap = null;
    bitmap = ThumbnailUtils.createVideoThumbnail(videoPath, kind);
    bitmap = ThumbnailUtils.extractThumbnail(bitmap, width, height, ThumbnailUtils.OPTIONS_RECYCLE_INPUT);
    return bitmap;
}</pre>

可见，这个方法只能由图片的**width和height**，通过_**extractThumbnail**_来从一定程度上压缩图片，并没有_**BitmapFactory.Options**_来得彻底。另外，第四个参数建议使用_**ThumbnailUtils.OPTIONS_RECYCLE_INPUT**_参数，这样就能回收第一个bitmap的内存。

### 方法三

又来代码：

<pre class="lang:java decode:true ">private Bitmap createVideoThumbnail(String path, int width, int height) {
    Bitmap bitmap = null;
    MediaMetadataRetriever retriever = new MediaMetadataRetriever();
    int kind = MediaStore.Video.Thumbnails.MINI_KIND;
    try {
        retriever.setDataSource(path);
        bitmap = retriever.getFrameAtTime();
    } catch (IllegalArgumentException ex) {
        // Assume this is a corrupt video file
    } catch (RuntimeException ex) {
        // Assume this is a corrupt video file.
    } finally {
        try {
            retriever.release();
        } catch (RuntimeException ex) {
            // Ignore failures while cleaning up.
        }
    }
    if (kind == Images.Thumbnails.MICRO_KIND &amp;&amp; bitmap != null) {
        bitmap = ThumbnailUtils.extractThumbnail(bitmap, width, height,
                ThumbnailUtils.OPTIONS_RECYCLE_INPUT);
    }
    return bitmap;
}</pre>

重点是_**retriever.getFrameAtTime()**_这段代码，可见，_**MediaMetadataRetriever**_是可以获取视频特定时间点的缩略图的，有一个带参数的方法：_**getFrameAtTime(long timeUS);**_

&nbsp;